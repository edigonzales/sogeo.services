<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8"/>
    <title>GeoAdmin API Plugin für QGIS</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">
    <meta name="keywords" content="">
    <meta name="generator" content="JBake">

    <!-- Le styles -->
    <link href="../../../../css/bootstrap.min.css" rel="stylesheet">
    <link href="../../../../css/asciidoctor.css" rel="stylesheet">
    <link href="../../../../css/base.css" rel="stylesheet">
    <link href="../../../../css/prettify.css" rel="stylesheet">
    <link href="../../../../css/sogeo.css" rel="stylesheet">

    <!-- web fonts -->
    <link rel="stylesheet" href="../../../../css/zurich.css" type="text/css">
    <link rel="stylesheet" href="//cdn.jsdelivr.net/font-hack/2.019/css/hack.min.css">
    
    <!--[if lt IE 9]>
      <script src="../../../../js/html5shiv.min.js"></script>
    <![endif]-->

    <!-- Fav and touch icons -->
    <!--<link rel="apple-touch-icon-precomposed" sizes="144x144" href="../assets/ico/apple-touch-icon-144-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="../assets/ico/apple-touch-icon-114-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="../assets/ico/apple-touch-icon-72-precomposed.png">
    <link rel="apple-touch-icon-precomposed" href="../assets/ico/apple-touch-icon-57-precomposed.png">-->
    <link rel="shortcut icon" href="../../../../favicon.ico">
  </head>
  <body onload="prettyPrint()">
    <div id="wrap">

	<!-- Fixed navbar -->
    <div class="navbar navbar-default navbar-fixed-top" role="navigation">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
        </div>
        <div class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
			<li><a href="../../../../index.html">Home</a></li>
			<li><a href="../../../../archive.html">Archive</a></li>
            <li><a href="../../../../feed.xml">Subscribe</a></li>
          </ul>
        </div><!--/.nav-collapse -->
      </div>
    </div>

    <div class="container">

	<div class="page-header">
		<h1>GeoAdmin API Plugin für QGIS</h1>
	</div>

	<p class="date"><em>24 August 2014</em></p>

	<p><div class="paragraph">
<p>Swisstopo stellt eine <a href="http://www.geo.admin.ch/internet/geoportal/de/home/services/geoservices/display_services/api_services.html">Programmierschnittstelle (API)</a> zur Verfügung mit der man Webseiten mit Swisstopo-Karten verschönern kann. Diese API ist sauber <a href="http://api3.geo.admin.ch/index.html">dokumentiert</a> und neben der eigentlichen Javascript-API stehen ebenfalls auch <a href="http://api3.geo.admin.ch/services/sdiservices.html">REST-Schnittstellen</a> online.</p>
</div>
<div class="paragraph">
<p>Interessant ist vor allem der <a href="http://api3.geo.admin.ch/services/sdiservices.html#search">Suchdienst</a>, mit dem man neben Adressen und administrativen Einheiten (Kantone, Bezirke) auch Grundstücke suchen kann. Folgender Request liefert Informationen zum Grundstück Nr. 2585 in Solothurn:</p>
</div>
<div class="paragraph">
<p><a href="http://api3.geo.admin.ch/rest/services/api/SearchServer?searchText=Solothurn%202585&amp;origins=parcel&amp;type=locations">http://api3.geo.admin.ch/rest/services/api/SearchServer?searchText=Solothurn%202585&amp;origins=parcel&amp;type=locations</a></p>
</div>
<div class="paragraph">
<p>Leider darf die Adresssuche nur von der Bundesverwaltung gebraucht werden. Sucht man nach einer bestimmten Adressen, wird zwar eine Antwort geliefert, diese beinhaltet aber keine Georeferenzierung (kein <code>geom_st_box2d</code> Attribut):</p>
</div>
<div class="paragraph">
<p><a href="http://api3.geo.admin.ch/rest/services/api/SearchServer?searchText=Solothurn%20Werkhofstrasse%2017&amp;origins=address&amp;type=locations">http://api3.geo.admin.ch/rest/services/api/SearchServer?searchText=Solothurn%20Werkhofstrasse%2017&amp;origins=address&amp;type=locations</a></p>
</div>
<div class="paragraph">
<p>Ebenfalls gesucht werden können Layer, die in der GeoAdmin API zur Verfügung stehen. Dieser Request liefert Layer zur Thematik <em>Fixpunkte</em>:</p>
</div>
<div class="paragraph">
<p><a href="http://api3.geo.admin.ch/rest/services/api/SearchServer?searchText=Fixpunkte&amp;type=layers">http://api3.geo.admin.ch/rest/services/api/SearchServer?searchText=Fixpunkte&amp;type=layers</a></p>
</div>
<div class="paragraph">
<p>Zu guter Letzt lassen sich mit dem Suchdienst auch Features suchen, z.B. den Fixpunkt 11277510:</p>
</div>
<div class="paragraph">
<p><a href="http://api3.geo.admin.ch/rest/services/api/SearchServer?features=ch.swisstopo.fixpunkte-lfp1&amp;type=featuresearch&amp;searchText=11277510">http://api3.geo.admin.ch/rest/services/api/SearchServer?features=ch.swisstopo.fixpunkte-lfp1&amp;type=featuresearch&amp;searchText=11277510</a></p>
</div>
<div class="paragraph">
<p>Nicht alle Layer der GeoAdmin API sind <a href="http://api3.geo.admin.ch/api/faq/index.html#which-layers-are-searchable">durchsuchbar</a>.</p>
</div>
<div class="paragraph">
<p>Mit diesen REST-Schnittstellen kann ein QGIS-Plugin erstellt werden, das ähnliche Funktionen bietet, wie die Suchfunktion auf <a href="http://map.geo.admin.ch">map.geo.admin.ch</a>. Dh. Lokalisationen können gesucht werden und es kann an den ausgewählten Ort gezoomt werden. Angebotene Layer können gesucht und in QGIS hinzugefügt werden. Features von durchsuchbaren Layer können gesucht werden und ein Popup-Fenster erscheint, falls etwas ausgewählt wurde.</p>
</div>
<div class="paragraph">
<p>Screenshots:</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="../../../../../images/geoadmin_search/gas_parcel.png" alt="Parzellensuche">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="../../../../../images/geoadmin_search/gas_layer.png" alt="Layersuche">
</div>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="../../../../../images/geoadmin_search/gas_feature.png" alt="Featuresuche">
</div>
</div>
<div class="paragraph">
<p>Die Layersuche resp. das anschliessende Hinzufügen des Layers in QGIS ist noch unbefriedigend gelöst. In den Plugineinstellungen lässt sich wählen, ob der Layer als <em>WMS</em> oder <em>WMTS</em> hinzugefügt werden soll:</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="../../../../../images/geoadmin_search/gas_provider.png" alt="Provider">
</div>
</div>
<div class="paragraph">
<p>Einige der Layer sind nur als WMS, andere nur als WMTS vorhanden. So wird zuerst also versucht den Layer mit dem Provider hinzuzufügen, den man in den Einstellungen gewählt hat. Klappt das nicht, wird der andere Provider gewählt.</p>
</div>
<div class="paragraph">
<p>Das führt auch gleich zum Thema/<strong>Problem</strong> <em>&laquo;Terms of use&raquo;</em>. Der WMTS-Dienst darf gemäss <a href="http://www.swisstopo.admin.ch/internet/swisstopo/de/home/products/services/web_services/webaccess.html">Webseite</a> nicht in Desktop-Applikationen verwendet werden: "Nur für Websites, kein Desktop-Zugriff". Wird beim Anfordern der Kachel <strong>kein</strong> Referer mitgeschickt, verweigert der Server die Auslieferung der Kachel. Zwar kann man sich mit einer Domain gratis <a href="http://www.geo.admin.ch/internet/geoportal/de/home/services/geoservices/display_services/api_services/order_form.html">registrieren</a> aber die Desktop-Applikation hat halt keine Domain.</p>
</div>
<div class="paragraph">
<p>Bleibt der WMS-Dienst: Gewisse Layer sind nicht frei verfügbar (z.B. Pixelkarten) und nicht im &laquo;normalen&raquo; <a href="http://wms.geo.admin.ch/?REQUEST=GetCapabilities&amp;SERVICE=WMS&amp;VERSION=1.0.0">BGDI-WMS</a> enthalten. Für diese Dienste gibt es einen zweiten <a href="http://www.swisstopo.admin.ch/internet/swisstopo/de/home/products/services/web_services/geoservices/swisstopo_wms.html">WMS-Dienst</a>. 5000 Megapixel/Jahr sind <a href="http://www.toposhop.admin.ch/de/shop/products/geoservice/swisstopoWMS">gratis</a>. Leider lässt sich mit keiner REST-Schnittstelle exakt eruieren, ob ein Layer als WMS und/oder als WMTS verfügbar ist. So meint das Plugin, dass das Orthofoto (SWISSIMAGE) nur als WMTS-Layer verfügbar ist, da in den <a href="http://api3.geo.admin.ch/rest/services/api/MapServer?searchText=ch.swisstopo.swissimage">Metainformation</a> beim Layer <code>ch.swisstopo.swissimage</code> das Attribut <code>wmsUrlResource</code> fehlt. Login und Passwort für den geschützten WMS lassen sich in den Plugineinstellungen speichern. Es macht den Anschein, dass entweder mein Plugin, QGIS oder der passwortgeschützte WMS von Zeit zu Zeit Probleme beim Verbinden verursacht. Erscheint in QGIS die Fehlermeldung <code>Error: Layer is not valid.</code> lohnt sich ein erneuter Versuch (irgend ein &laquo;Redirect loop detected&raquo;-Problem).</p>
</div>
<div class="paragraph">
<p>Das Plugin <em>GeoAdmin Search</em> liegt im <a href="http://plugins.qgis.org/plugins/plugins.xml?qgis=2.4">QGIS Plugin Repository</a>. Quellcode gibts hier: <a href="https://bitbucket.org/edigonzales/qgis_geoadminsearch">https://bitbucket.org/edigonzales/qgis_geoadminsearch</a>.</p>
</div></p>

	<p class="author">
		Posted by Stefan Ziegler. |
		<a href="/tags/GeoAdmin.html">GeoAdmin</a>
		, <a href="/tags/API.html">API</a>
		, <a href="/tags/QGIS.html">QGIS</a>
		, <a href="/tags/QGIS-Plugin.html">QGIS-Plugin</a>
		, <a href="/tags/WMS.html">WMS</a>
		, <a href="/tags/WMTS.html">WMTS</a>
		
	</p>

	<hr />

		</div>
		<div id="push"></div>
    </div>

    <div id="footer">
      <div class="container">
        <p class="muted credit">&copy; 2016 Stefan Ziegler | Baked with <a href="http://jbake.org">JBake v2.4.0</a></p>
      </div>
    </div>

    <!-- Le javascript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="../../../../js/jquery-1.11.1.min.js"></script>
    <script src="../../../../js/bootstrap.min.js"></script>
	<script src="../../../../js/prettify.js"></script>
  </body>
</html>
